📘 rule.xlsx 配置欄位說明書 (v5)
🟢 第一區：索引與匹配 (身分證)
1. Item_Name (項目名稱)
• 用途：系統用來配對工單項目的「唯一鑰匙」。
• 比對邏輯：
1. 智慧脫殼：系統會自動忽略標題末尾的括號，例如 (2SET)、(10PC)。
2. 同分決勝：若有多個規則相似，系統會選擇「長度最接近」的那個（避免短字串誤配）。
3. 容錯率：85分 (Partial Ratio)，容許少許錯字（如：輥/報、銲/焊）。
• 填寫建議：填寫工單上的核心名稱即可，如 W3 #5 驅動輥輪 本體再生車修。
🔵 第二區：會計核對 (單項與運費)
控制「單一項目內的數量」以及「運費怎麼算」。
2. Unit_Rule_Local (單項核對規則)
• 用途：檢查 「標題數量 (Target)」 與 「內文行數 (Actual)」 是否吻合。
• 公式邏輯：標題單位 = 內文行數 (除數在等號右邊)
• 常用語法：
• 1SET=4PCS：標題寫 1 SET，但內文有 4 行數據。(程式計算：實際行數 / 4)
• 1SET=2PCS：標題寫 1 SET，但內文有 2 行數據。
• PC=PC：去重計數。不管測了幾個點，只計算有幾個不同的編號 (ID)。
• 豁免：完全不檢查此項目的數量統計（直接亮綠燈）。
3. Unit_Rule_Freight (運費計算規則)
• 用途：決定這個項目要不要算運費，以及幾支算一筆。
• 公式邏輯：實體數量 = 1 筆運費 (除數在等號左邊)
• 常用語法：
• 4PC=1：每做 4 個實體，才算 1 筆運費。(程式計算：實際數量 / 4)
• 豁免：強制不計入運費 (金額 = 0)。
• 計入 (或留空)：預設行為。若標題含「本體+未再生/粗車」會自動計入，否則不計。
🟠 第三區：工程與分類控制 (Python 硬邏輯)
用來解決「掛羊頭賣狗肉」或「強制略過檢查」的情況。
4. Category_Rule (強制分類規則)
• 用途：強制覆蓋 Python 的自動分類判斷。優先權最高。
• 常用語法 (填入以下關鍵字)：
• 再生車修 (或 range)：強制執行 區間/公差檢查 (即使名字叫未再生)。
• 本體未再生 (或 un_regen)：強制執行 整數檢查 (小數點後需為 0)。
• 軸頸未再生 (或 max_limit)：強制執行 上限檢查。
• 銲補 (或 min_limit)：強制執行 下限檢查。
• 豁免 (或 exempt)：工程引擎直接跳過此項目，完全不檢查尺寸數值 (不報異常)。
🟣 第四區：總表對帳控制 (Aggregation)
控制這個項目如何匯總到左上角的「Summary Table」。
5. Unit_Rule_Agg (總表核對規則)
• 用途：決定項目要丟進哪個籃子，以及數量的換算比例。
• 語法格式：[模式], [換算] (中間用逗號隔開，可單獨使用)
• 模式關鍵字 (Mode)：
• A：強制一般核對。直接拿項目名稱去跟總表名稱比對，禁止 進入「車修/拆裝/銲補」自動籃子。
• B：強制籃子核對。優先嘗試丟進自動籃子 (預設值)。
• 豁免：完全不計入總表 (對帳時忽略此項)。
• 換算公式 (Math)：
• 2=1：左邊(實體) = 右邊(總表)。即「每 2 個實體項目，在總表只算 1 個」。
• 1=1 (預設)：實體多少個，總表就算多少個。
• 組合範例：
• A, 2=1：強制走一般名稱比對，且數量除以 2。
• 豁免：不計入總表。
• A：強制走一般名稱比對，數量不變。
⚪ 第五區：AI 輔助 (Prompt)
這區不影響 Python 算錢或報錯，純粹是給 AI 看的「小抄」，增加 OCR 準確度。
6. Standard_Spec (標準規格)
• 寫法：填入標準值，如 161 +0/-0.025 或 135mm。
7. Logic_Prompt (例外指令)
• 寫法：如 忽略輕微刮痕、注意手寫修改。