rules.xlsx 特規欄位使用說明書 (v13 最終版)
本文件說明 rules.xlsx 中各特規欄位的控制邏輯。此 Excel 檔為 Python 自動化引擎的 中央控制面板，負責控制工程判定、會計對帳與流程檢查。


1. 工程引擎 (Engineering)
對應欄位：Category_Rule
功能：強制覆蓋 AI 的自動分類判斷，決定該項目要執行哪種數值檢查。
優先權：最高 (Excel 設定 > Python 自動判斷)。
有效關鍵字與邏輯
 * 再生車修 或 range
   * 邏輯：Range (區間)
   * 用途：檢查公差 (如 +0/-0.025)。適用於精加工、組裝。
 * 本體未再生 或 un_regen
   * 邏輯：Un_regen (整數)
   * 用途：檢查數值是否為整數 (小數點後為0)。適用於粗胚、未再生。
 * 銲補 或 min_limit
   * 邏輯：Min Limit (下限)
   * 用途：檢查數值是否大於標準。適用於銲補後尺寸。
 * 軸頸 或 max_limit
   * 邏輯：Max Limit (上限)
   * 用途：檢查數值是否小於標準。適用於磨耗檢查。
 * 豁免 或 exempt
   * 邏輯：Skip
   * 用途：完全不檢查此項目的尺寸數值。
> ℹ️ 互斥鎖提示：
> 若標題同時出現「未再生」與「再生」，系統內建互斥鎖會優先判定為「未再生」。但為了保險起見，建議在此欄位明確指定。


2. 會計引擎 (Accounting)
對應欄位：Unit_Rule_Local, Unit_Rule_Agg, Unit_Rule_Freight
核心邏輯：採 雙軌制。
 * 若下游 (總表/運費) 有寫換算公式，則回溯 原始行數 (Raw Count) 計算。
 * 若下游無公式，則 繼承 上游 (單項) 的計算結果。
2-1. 單項核對 (Unit_Rule_Local)
檢查「標題目標數 (Target)」與「內文實際行數」是否符合。
語法格式：[數量] = [目標] (程式會自動忽略 SET/PC 等單位文字)
 * 4=1 (或 1SET=4PCS)
   * 意義：內文每抓到 4 行數據，算作 1 個目標單位。(除以 4)
 * 1=1 (或 1=1)
   * 意義：1 行數據 = 1 個目標單位。
 * PC=PC
   * 意義：去重計數。不管量測幾點，只算有幾個「不重複的編號」。
 * 豁免
   * 意義：不檢查此項目的數量統計。
2-2. 總表對帳 (Unit_Rule_Agg)
決定項目如何計入左上角的總表 (Summary Table)。
語法格式：[模式], [換算] (逗號隔開，可單獨使用)
A. 模式設定 (Mode)
 * A：強制一般比對。只看名稱相似度 (>90%)，不進分類籃子。
 * B：強制籃子比對。嘗試丟入 車修/拆裝/銲補 籃子 (預設值)。
 * AB：混合模式。只要符合 A (名稱) 或 B (籃子) 任一條件即計入。
 * 豁免：完全不計入總表。
B. 數量換算 (Math)
 * 4=1：使用 原始行數 (Raw Count) 除以 4 後計入總表。
 * (不填寫)：直接繼承「單項核對」算出來的結果。
> 🛡️ 全方位互斥鎖 (Conflict Check)
> 即使符合 A/B 模式，系統仍會強制執行以下檢查，不符則踢除：
>  * 動作互斥：總表若為「未再生」，絕不收「再生」或「銲補」項目。
>  * 部位互斥：總表若為「本體」，絕不收「軸頸」項目 (反之亦然)。
2-3. 運費計算 (Unit_Rule_Freight)
計算該項目產生多少運費。
 * 4=1：使用 原始行數 除以 4 計算運費筆數。
 * 計入 (或空白)：繼承「單項核對」的數量。
 * 豁免：運費 = 0。


3. 流程引擎 (Process)
對應欄位：Process_Rule
功能：當標題關鍵字不明確時，強制指定該項目的「軌道」與「工序」。
有效關鍵字
系統會偵測以下關鍵字來設定流程節點：
 * 本體未再生 ➔ Track: 本體 / Stage: 1
 * 本體銲補 ➔ Track: 本體 / Stage: 2
 * 本體再生 ➔ Track: 本體 / Stage: 3
 * 本體研磨 ➔ Track: 本體 / Stage: 4
 * 軸頸未再生 ➔ Track: 軸頸 / Stage: 1
 * (以此類推...)
 * 豁免 ➔ 完全不參與流程檢查 (不報溯源異常)。


4. 其他通用欄位
Item_Name (索引名稱)
 * 必填。系統與 AI 標題進行 Fuzzy Match 的基準。
 * 技巧：不需要寫括號內的數量 (如 (2SET) )，寫核心名稱即可。
Standard_Spec (標準規格)
 * 給 AI 的 Prompt 提示。例如：161 +0/-0.025。
Logic_Prompt (例外指令)
 * 給 AI 的特殊文字指令。例如：忽略手寫修改。
⚡️ 速查清單 (Cheat Sheet)
這裡列出常見情境的解決方案：
 * 情境：這個項目不驗公差，要驗整數。
   * 解法：Category_Rule 填入 本體未再生。
 * 情境：這個項目是 4 個零件湊成 1 組 (單項)。
   * 解法：Unit_Rule_Local 填入 4=1。
 * 情境：總表對帳一直抓錯，我要它只對名稱，不要進籃子。
   * 解法：Unit_Rule_Agg 填入 A。
 * 情境：總表數量要除以 4 (不管單項怎麼算，我要重算)。
   * 解法：Unit_Rule_Agg 填入 4=1。
 * 情境：這項完全不算總表。
   * 解法：Unit_Rule_Agg 填入 豁免。
 * 情境：這項不產生運費。
   * 解法：Unit_Rule_Freight 填入 豁免。
 * 情境：標題有寫「軸頸」，但它其實只是清潔，不是軸頸加工流程。
   * 解法：Process_Rule 填入 豁免。